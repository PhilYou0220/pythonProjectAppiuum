import pymysql
import requests


def db(sql):
    conn = pymysql.connect(host="221.237.182.170", port=3326, user='epuser', password='epuser@123-TFblue',
                           database='ep')
    cursor = conn.cursor(cursor=pymysql.cursors.DictCursor)
    cursor.execute(sql)
    result = cursor.fetchall()  # [{},{}]
    car_len = len(result)
    cursor.close()
    conn.close()
    return result, car_len


def car_inout_sql():
    start_time = "2021-11-09 00:00:00"
    end_time = "2021-11-09 23:59:59"
    sql = """
        SELECT url FROM ss_car_media WHERE ticket_id
            IN
            (SELECT id FROM ss_electric_ticket WHERE number IN
 (
"202111225221","202111225195","202111225173","202111224994","202111224899","202111224896","202111224893","202111224857","202111224852","202111224793","202111224779","202111224743","202111224738","202111224723","202111224667","202111224665","202111224632","202111224607","202111224600","202111224586","202111224528","202111224521","202111224443","202111224415","202111224326","202111224247","202111224231","202111224199","202111224101","202111224078","202111224020","202111224010","202111223899","202111223876","202111223865","202111223823","202111223822","202111223689","202111223527","202111223455","202111223436","202111223351","202111223430","202111223536","202111223345","202111223399","202111223272","202111223219","202111223191","202111223169","202111223168","202111223152","202111223145","202111223126","202111223120","202111223068","202111223061","202111223054","202111223049","202111223040","202111222894","202111222806","202111222608","202111222571","202111222521","202111222383","202111222380","202111222462","202111222355","202111222328","202111222263","202111221909","202111221897","202111221523","202111221399","202111221373","202111221363","202111221341","202111221340","202111221296","202111221225","202111221125","202111220995","202111221043","202111220797","202111220485","202111220415","202111220378","202111220340","202111220300","202111220299","202111220298"
            )) AND type=13
    """
    return sql


if __name__ == '__main__':
    my_sql = car_inout_sql()
    my_result, my_car_len = db(my_sql)  # [a,b,c]
    my_header = "https://file.shomes.cn/minio/"
    path = "./picture1/"
    count = 0
    for i in my_result:
        count += 1
        for j in i.values():
            if j is not None:
                r = requests.get(my_header + j)
                with open(path + j[-10:], 'wb') as f:
                    f.write(r.content)
                    print("{}/{}".format(count, my_car_len))
